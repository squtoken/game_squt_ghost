<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | SqutGame</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <!-- Include Web3.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
</head>
<body>
    <div id="unity-container" class="unity-desktop">
        <canvas id="unity-canvas" width="960" height="600" tabindex="-1"></canvas>
        <div id="unity-loading-bar">
            <div id="unity-logo"></div>
            <div id="unity-progress-bar-empty">
                <div id="unity-progress-bar-full"></div>
            </div>
        </div>
        <div id="unity-warning"> </div>
        <div id="unity-footer">
            <div id="unity-webgl-logo"></div>
            <div id="unity-fullscreen-button"></div>
            <div id="unity-build-title">SqutGame</div>
        </div>
    </div>
    <script>
        // MetaMask integration scripts
        async function loadWeb3() {
            if (window.ethereum) {
                window.web3 = new Web3(window.ethereum);
                console.log("MetaMask is installed!");
            } else {
                alert("Please install MetaMask to use this feature!");
                return;
            }

            try {
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                const accounts = await web3.eth.getAccounts();
                console.log("Connected account:", accounts[0]);
                // Proceed to check for the right network (Binance Smart Chain)
                await switchToBinanceSmartChain();
            } catch (error) {
                console.error("User denied account access:", error);
            }
        }

        async function switchToBinanceSmartChain() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x38' }], // This is the chain ID for Binance Smart Chain
                });
                console.log("Switched to Binance Smart Chain");
            } catch (switchError) {
                if (switchError.code === 4902) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [
                                {
                                    chainId: '0x38',
                                    rpcUrl: 'https://bsc-dataseed.binance.org/',
                                },
                            ],
                        });
                    } catch (addError) {
                        console.error("Could not add Binance Smart Chain:", addError);
                    }
                }
                console.error("Could not switch to Binance Smart Chain:", switchError);
            }
        }

        // Existing game loading scripts
        var container = document.querySelector("#unity-container");
        var canvas = document.querySelector("#unity-canvas");
        var loadingBar = document.querySelector("#unity-loading-bar");
        var progressBarFull = document.querySelector("#unity-progress-bar-full");
        var fullscreenButton = document.querySelector("#unity-fullscreen-button");
        var warningBanner = document.querySelector("#unity-warning");
        // Additional setup and loader script as previously defined
        // ...
        // Consider calling loadWeb3() at an appropriate moment, such as after the game loads or via a user interaction

        document.body.appendChild(script);

        // Example: To automatically attempt connection on game load, uncomment the following line:
        // window.addEventListener('load', loadWeb3);
    </script>
</body>
</html>
